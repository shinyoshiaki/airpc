{"version":3,"file":"workerThreads.js","sourceRoot":"","sources":["../../../src/module/workerThreads.ts"],"names":[],"mappings":";;AACA,mDAAoE;AAEpE,+BAA+B;AAElB,QAAA,oBAAoB,GAAG,CAAC,MAAc,EAAW,EAAE;IAC9D,MAAM,OAAO,GAAG,IAAI,cAAO,EAAc,CAAC;IAE1C,MAAM,IAAI,GAAG,CAAC,KAAiB,EAAE,EAAE;QACjC,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,IAAI,+BAAc,EAAE,CAAC;QAE9C,KAAK,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE;YACtB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;QAEH,MAAM,CAAC,WAAW,CAChB;YACE,IAAI,EAAE,KAAK;YACX,KAAK;SACN,EACD,CAAC,KAAK,CAAC,CACR,CAAC;IACJ,CAAC,CAAC;IAEF,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;AAC3B,CAAC,CAAC;AAEW,QAAA,oBAAoB,GAAG,GAAY,EAAE;IAChD,MAAM,OAAO,GAAG,IAAI,cAAO,EAAiB,CAAC;IAE7C,IAAI,2BAAU,EAAE;QACd,2BAAU,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,EAAE;YAC9B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC;YAC7B,OAAO,CAAC,IAAI,CAAC,EAAE,WAAW,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;QACjE,CAAC,CAAC,CAAC;KACJ;IAED,OAAO,OAAO,CAAC;AACjB,CAAC,CAAC","sourcesContent":["import { Exposer, ExposerObject, Wrapper } from \"../main\";\nimport { MessageChannel, Worker, parentPort } from \"worker_threads\";\n\nimport { Subject } from \"rxjs\";\n\nexport const workerThreadsWrapper = (worker: Worker): Wrapper => {\n  const subject = new Subject<Uint8Array>();\n\n  const post = (value: Uint8Array) => {\n    const { port1, port2 } = new MessageChannel();\n\n    port1.on(\"message\", s => {\n      subject.next(s);\n    });\n\n    worker.postMessage(\n      {\n        port: port2,\n        value\n      },\n      [port2]\n    );\n  };\n\n  return { subject, post };\n};\n\nexport const workerThreadsExposer = (): Exposer => {\n  const subject = new Subject<ExposerObject>();\n\n  if (parentPort) {\n    parentPort.on(\"message\", data => {\n      const { port, value } = data;\n      subject.next({ postMessage: v => port.postMessage(v), value });\n    });\n  }\n\n  return subject;\n};\n"]}